Обновление миграций при migrate/redo
================================
Данное расширение позволяет не терять данные при выполнении `./yii migrate/redo`

Все мы знаем, что у Yii2 нет системы обновления таблиц. Там есть redo, которое
удаляет таблицу и создает заново по указанным правилам. Это хорошо, но иногда,
нужно обновить систему, включая таблицы и при этом не терять данные.

Данное решение это позволяет, но при условии, что новые поля, появившиеся в таблице будут с разрешением `null`.
Кроме того, в новй таблице не должно удаляться старых столбцов.

Потом может и это исправим, но на начальных этапах будет так.


Установка
------------

Для установки, используется композер [composer](http://getcomposer.org/download/).

Запустите

```
php composer.phar require --prefer-dist dastanaron/yii2-migrate-updater "*"
```

или добавьте

```
"dastanaron/yii2-migrate-updater": "*"
```

в секцию require, файла `composer.json`
и запустите

```
php composer.phar update
```


Использование
-----

Использование довольно простое, вы должны установить данное решение
и подключить класс, в вашем классе миграции. 

Для сохранения миграций, нужно подключить класс расширения миграций, и использовать именно его,
для создания своих миграций. Кроме того, необходимо объявить публичную переменную с названием таблицы `public $tableName`

```php
<?php

use dastanaron\yiimigrate\updater\ExtMigration;

class m171226_130601_youmigrationclass extends ExtMigration {
    
    public $tableName = 'youmigrationtable';
    
    //body class
    
}
```

По умолчанию, в классе используется флаг, разрешающий или запрещающий сохранение данных,
он задан в родительском классе как `public $saveData = true;`, если вам не нужно пытаться сохранить данные,
переназначьте данное свойство в своем классе, чтобы отключить этот функционал

```php
<?php

use dastanaron\yiimigrate\updater\ExtMigration;

class m171226_130601_youmigrationclass extends ExtMigration {
    
    public $tableName = 'youmigrationtable';
    
    public $saveData = false; //disable data saving
    
    //body class
    
}
```

Всю функциональность расширения, выполняет вспомогательный класс TableData. Ниже, вы сможете ознакомиться с его методами
и свойствами, которые вы можете использовать вне расширения миграций и для диагностики.

Методы класса TableData
--------------

* **`getData()`** - делает запрос в базу на получение данных, с помощью `yii\db\Query`

* **`Dump($type = 'create')`** - создает либо читает дамп таблицы, соответственно передаваемые параметры `create` или `read`

* **`getInsertString()`** - получает собранную `insert sql` строку. Для диагностики

## Внимание

После считывания, дамп удаляется

Если требуется посмотреть массив собранный или другие данные, то
можно воспользоваться публичными свойствами классса `TableData`

Публичные свойства
-------------------

* **`$tablename`** - имя таблицы, получается в кострукторе

* **`selecteddata`** - после запроса, будет содержать массив данных.

* **`$sqlstring`** - строка запроса, получается после его сборки
